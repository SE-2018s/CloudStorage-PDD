\chapter{接口设计}
\section{外部接口}

\subsection{HTTP接口}
xyz云盘系统通过HTTP请求的方式实现API调用。

\subsubsection{初始界面接口}
URL：/api/index

请求类型：GET

参数：无参数
 
返回值:返回初始页面

\subsubsection{登录接口}
URL：/api/login

请求类型：POST

参数：

• username:用户名/邮箱

• pass:密码经过密码学处理之后的字符串
 
返回值:bool类型,表示是否成功,同时设置cookie

\subsubsection{注册接口}
URL：/api/register

请求类型：POST

参数：

• username:用户名

• email:邮箱

• 密码:密码经过密码学处理之后得到的字符串

返回值:bool类型,表示是否注册成功.如果成功,则附带一个分享链接

\subsubsection{忘记密码接口}
URL：/api/forget

请求类型：POST

参数：

• username:用户名/邮箱

返回值:返回bool值表示是否成功.如果用户存在,则服务器向该邮箱发送重设密码的链接.

\subsubsection{登陆后接口}
URL：/api/home

请求类型：GET

参数：

• cookie,无需用户手动输入

返回值:显示登陆后的页面。

\subsubsection{上传接口}
URL：/api/upload

请求类型：POST

参数：

• path：文件的路径

• cookie,无需用户手动输入

返回值:bool类型，表示是否成功。并返回显示的页面

\subsubsection{下载接口}
URL：/api/download

请求类型：GET

参数：

• path：文件路径

• link:可选,可以直接下载链接(尤其是游客)

• cookie：无需用户手动输入

返回值:bool类型，表示是否成功。

\subsubsection{重命名接口}
URL：/api/rename

请求类型：POST
 
参数：

• path：旧文件路径

• path：新文件名

• cookie：无需用户手动输入

返回值:bool类型，表示是否成功。

\subsubsection{粘贴接口}
URL：/api/paste

请求类型：POST

参数：

• path：旧文件路径

• path：新文件路径

• cookie：无需用户手动输入

返回值:bool类型，表示是否成功。并返回页面

\subsubsection{新建文件夹接口}
URL：/api/newDir

请求类型：POST

参数：

• path:文件夹路径

• cookie:无需用户手动输入

返回值:bool类型，表示是否成功。并返回页面

\subsubsection{打开文件夹接口}
URL：/api/openDir

请求类型：GET

参数：

• path:文件夹路径

• cookie:无需用户手动输入

返回值:bool类型，表示是否成功。并返回显示的页面
\subsubsection{返回上一级文件夹接口}
URL：/api/openDir

请求类型：GET

参数：

• path:文件夹路径

• cookie:无需用户手动输入

返回值:bool类型，表示是否成功。并返回显示的页面

\subsubsection{排序显示接口}
URL：/api/sort.do

请求类型：GET

参数：

• path:文件夹路径

• attribute:排序根据的属性

• cookie:无需用户手动输入

返回值:bool类型,表示是否成功。并返回显示的页面

\subsubsection{移入移出回收站接口}
URL：/api/garbage.do

请求类型：POST

参数：

• path:文件路径

• op:表示移入还是移出,还是彻底删除

• cookie:无需用户手动输入

返回值:bool类型,表示是否成功.并返回显示的页面

\subsubsection{移入移出收藏夹接口}
URL：/api/collection

请求类型：POST

参数：

• path:文件路径

• op:表示移入还是移出收藏夹

• cookie:无需用户手动输入

返回值:bool类型,表示是否成功.并返回显示的页面
 
\subsubsection{登录接口}
URL：/api/lookupattribute

请求类型：GET

参数：

• path:文件路径

• cookie:无需用户手动输入

返回值:bool类型,表示是否成功

\subsubsection{压缩/解压缩接口}
URL：/api/zip

请求类型：POST

参数： 

• path:文件路径

• op:表示压缩还是解压缩

• cookie:无需用户手动输入

返回值:bool类型,表示是否成功.并返回显示的页面

\subsubsection{举报接口}
URL：/api/report

请求类型：POST

参数： 

• path:文件路径

• cookie:无需用户手动输入

返回值:bool类型,表示是否成功并返回显示的页面

\subsubsection{搜索接口}
URL：/api/search.do

请求类型：POST

参数： 

• path:文件路径

• cookie:无需用户手动输入

返回值:bool类型,表示是否成功.并返回显示的页面

\subsubsection{生成分享链接接口}
URL：/api/share.do

请求类型：POST

参数： 

• path:文件路径

• cookie:无需用户手动输入

返回值:链接的地址.并返回显示的页面

\subsubsection{导入链接接口}
URL：/api/getshare.do

请求类型：POST

参数： 

• link:要导入的链接

• path:文件夹

• cookie:无需用户手动输入

返回值:bool类型,表示是否成功.并返回显示的页面


\section{内部接口}

\subsection{MODULE.CLIENT(SERVER).1: 通信模块}

\subsubsection{connection create\_connection()}
说明：建立连接

\subsection{MODULE.CLIENT(SERVER).2: 登陆模块}

\subsubsection{user\_login(connection,loginfo)}
参数connection:浏览器和服务器间的连接

参数loginfo：用户登录信息

说明：用户登录账号
class loginfo：

String user\_name:用户名

String password:密码
\subsubsection{user\_register(connection, loginfo)}
参数connection:浏览器和服务器间的连接

参数loginfo：用户注册信息

说明：用户注册账号
\subsubsection{user\_find\_password(connection, user\_name, user\_email)}
参数connection:浏览器和服务器间的连接

参数user\_name:用户名

参数user\_email:用户注册时的电子邮箱

说明:忘记密码
\subsection{MODULE.CLIENT.3: 标签页模块}

\subsubsection{add\_tab(connection, tabinfo)}
参数connection:浏览器和服务器间的连接

参数tabinfo:已经打开的标签页信息

说明:创建标签页
\subsection{MODULE.CLIENT.4: 显示模块}

\subsubsection{show(connection)}
参数connection:浏览器和服务器间的连接

说明:显示标签页
\subsection{MODULE.CLIENT.5(SERVER.4)：传输模块}
\subsubsection{upload(connection, file， filepath)}
参数connection:浏览器和服务器间的连接

参数file:要传输的文件

参数filepath:云端文件路径

说明:传输文件到服务器
\subsubsection{download(connection, filepath)}

参数connection:浏览器和服务器间的连接

参数filepath:云端文件路径

说明:传输文件到客户端
\subsection{MODULE.SERVER.3：权限管理模块}
\subsubsection{check\_right(filepath,userId}
参数filepath::所要检查的文件路径.

参数userId:用户名

说明:检查用户名对该文件的权限

\subsection{MODULE.SERVER.5: 分享管理模块}
\subsubsection{create\_share(file\_path, fetch\_password, due\_time}
参数file\_path：要分享的文件的\_path

参数fetch\_password：下载该资源需要的密码

参数due\_time:链接失效日期

说明:生成分享链接

\subsubsection{send\_share(shareInfog's)}
class shareInfo:

    int owner\_path

    str link\_url

    str link\_passward

    time due\_time

\subsection{MODULE.SERVER.6: 收藏夹模块}

\subsubsection{add\_bookmark(bookmark\_path, file\_path)}
参数file\_path：将要添加到收藏夹的文件

参数bookmark\_path：收藏夹路径

说明:移入收藏夹
\subsubsection{delete\_bookmark(file\_path)}
参数file\_path:要删除文件的路径
 
说明:移出收藏夹
\subsection{MODULE.SERVER.7: 文件管理模块}

\subsubsection{insert\_file(file\_path, ceph\_obj)}
参数file\_path:将要插入ceph模块的文件路径

参数ceph\_obj:ceph的一个block对象

说明:添加文件

\subsubsection{drop\_file(ceph\_obj, file\_obj)}
参数ceph\_obj:ceph的一个block对象

说明:移入回收站

参数file\_obj:将要删除的该block里的文件
\subsection{MODULE.SERVER.8: 审核模块}
\subsubsection{report\_file(file\_path)}
参数file\_path:用户所举报的文件路径

说明:用户举报文件非法

\subsubsection{check\_legality(file\_obj)}
参数file\_obj:所要检查的文件路径.

说明:检查文件是否非法


\subsubsection{list(filepath)}
参数：filepath：路径

说明：将指定路径的文件列出来


\subsection{MODULE.SERVER.9：回收站模块}

\subsubsection{delete(userID, filepath)}
参数 userID：执行删除操作的用户

参数 filepath：要删除的文件路径

说明：将该文件置为被删除状态，添加到该用户的回收站列表中

\subsubsection{recover(userID, filepath)}
参数 userID：执行恢复操作的用户

参数 filepath：要恢复的文件路径

说明：将该文件从该用户的回收站列表中移除，置为正常状态

\subsubsection{list(userID)}
参数 userID

说明：列出该用户回收站中所有文件

\subsubsection{clean(userID)}
参数 userID：执行清空操作的用户

说明：清空该用户的回收站列表

\subsection{MODULE.SERVER.10：压缩模块}
\subsubsection{compress(filelist, zipname, level, password)}

参数：filelist：要压缩的所有文件、文件夹

参数：zipname：压缩文件的命名（带路径）

参数：level：压缩级别，从最快压缩速度到最高压缩率

参数：password：要添加的压缩密码

说明：对传入的文件列表创建一个压缩包

\subsubsection{depress(zipname, password)}
参数：zipname：压缩文件的名称（带路径）

参数：password：解压密码，可选

说明：对传入的压缩文件就地解压

\subsection{MODULE.SERVER.11：共享文件夹模块}
\subsubsection{open(foldername, userID)}
参数：foldername：共享文件夹名称

参数：userID：用户ID

说明：根据用户权限判断是否能否进入，若能则调用文件管理模块的接口
 
\subsubsection{list(userID)}
参数：userID：用户ID

说明：返回所有该用户可见的共享文件夹列表


